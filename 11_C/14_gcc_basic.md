# gcc & makefile 기본

## 1. gcc

컴파일러 -> 컴파일을 한다.

## 1. 옵션

1. -o 옵션

   - 출력(output) 파일명을 정한다.
   - 해당 옵션을 주지 않으면, 파일명은 `a.out`으로 고정된다.

   - `gcc -o 파일명 소스명`
   - `gcc -o hello hello.c`
   - 아래와 같이 순서를 바꿔도 무방하다.
     - `gcc hello.c -o hello`

2. -c 옵션
   - 컴파일 작업만 진행한다.
   - 링크가 되기 전, 컴파일 과정만 진행한다.
   - 일반적으로 실행파일이 생성될 때, 컴파일 단계 -> 링크 단계로 진행된다.
     - foo.c와 bar.c 두 파일을 컴파일한다고 생각해보자
     - 컴파일 단계는 이렇게 진행한다.
       - `gcc -c foo.c bar.c` 또는 `gcc -c foo.c; gcc -c bar.c`
     - 이후 링크 단계는 컴파일 과정에서 생성된 foo.o, bar.o 파일을 사용해 다음과 같이 진행한다.
       - `gcc -o baz foo.o bar.o`
     - gcc라는 실행어를 사용하는 것은 마찬가지이지만, 컴파일 단계는 cc1이, 링킹 단계는 ld라는 링커가 맡는다.
3. `-I`옵션
   - `#include`문에서 지정한 헤더 파일이 들어있는 곳을 정하는 옵션
   - 소스파일에서 `#include <stdio.h>` 와 같이 <>로 묶은 경우는 시스템 표준 헤더 디렉토리인 `/usr/include`를 기준으로 헤더 파일을 찾는다.
   - `#include "my_header.h"` 와 같이 `""`로 묶은 경우는 컴파일러가 실행되고 있는 현재 디렉토리를 기준으로 헤더 파일을 찾는다.
   - **위 두 디렉토리가 아닌 곳에 대해서는 명시적으로 `-I[디렉토리]` 옵션을 정해주어야 한다.**
   - **주의!**
     - 디렉토리명은 `-I` 문자 바로 다음에 붙여서 쓴다. 즉 `-I [디렉토리]`가 아니라 `-I[디렉토리]`이다.
     - 예를 들어, 현재 디렉토리를 include하라고 시킬 경우에는 `-I.` 옵션을 사용하면 된다.

> 참고: 라이브러리
>
> 반복적으로 사용하는 여러 개의 오브젝트 파일들을 묶어서, 매번 재컴파일 할 필요 없이 사용한다.
>
> 라이브러리 = 목차(index) + 오브젝트파일들(a.o + b.o+ ...)
>
> 형식은 다음과 같다.
>
> - .a : 리눅스 - 정적 라이브러리 - archive
> - .so : 리눅스 - 동적 라이브러리
> - .lib : 윈도우/유닉스 - 정적 라이브러리
> - .dll : 윈도우 - 동적 라이브러리
>
> 명령어는 다음과 같다.
>
> - `ar r 라이브러리명.a 오브젝트파일명.o`
>   - 해당 오브젝트파일을 라이브러리에 insert한다. 라이브러리가 없다면 생성한다.
>   - c옵션으로 라이브러리를 생성만 할 수도 있다.
>   - **라이브러리를 만들 때는 lib이 앞에 붙어야 하고, .a로 끝나야 한다.**
>     - libmylib.a 등
> - `ar s libmylib.a`
>   - 해당 라이브러리에 인덱스를 만든다.
>   - 이미 존재한다면 갱신한다.
> - `ar t libmylib.a`
>   - 해당 라이브러리 내부의 오브젝트 파일들을 보여준다.



4. `-l` 옵션(소문자 엘)
   - 링크할 라이브러리를 명시해준다.
   - `-I`와 마찬가지로 붙여서 사용한다.
   - 라이브러리명을 명시할때는, 라이브러리 앞의 lib과 뒤의 .a를 생략한다.
     - `-lmylib`

5. `-L` 옵션

   - ld가 찾을 수 있도록 사용할 라이브러리의 위치를 명시해준다.
     - 기본적으로, 리눅스에서는 /lib, /usr/lib, /usr/local/lib같은 정해진 장소에서만 라이브러리를 찾게 되어 있으므로 직접 명시해 주어야 한다.
   - `-I`와 비슷하게 사용한다. 

   - 라이브러리명을 명시할때는, 라이브러리 앞의 lib과 뒤의 .a를 생략한다.
     - `libmylib.a`가 라이브러리 파일이고, 소스파일과 같은 폴더에 있을 경우
     - `gcc -o my_project my_project.c -lmylib -L.` 